import BlogPost from '../../../components/BlogPost';

export const meta = {
  id: 6,
  img: '/static/cors-error.png',
  alt: 'CORS Error',
  title: 'Configuraci√≥n de CORS en ApolloServer',
  description: 'Ten√≠a un error con CORS en m√≠ API GraphQL que est√° construida con Apollo Server Lambda, cuando hac√≠a una solicitud desde el frontend me daba el t√≠pico error en la consola....',
  date: 'Feb. 27, 2021',
  readTime: 2
}

export default ({ children }) => <BlogPost meta={meta}>{children}</BlogPost>;

Ten√≠a un error con CORS en m√≠ API GraphQL que est√° construida con Apollo Server Lambda, cuando hac√≠a una solicitud desde el frontend me daba el t√≠pico error en la consola, que m√°s de uno/a debe haber visto alguna vez.
Pero yo me preguntaba, si en m√≠ API, s√≠ agregue la opci√≥n de CORS, entonces ¬øD√≥nde est√° el problema?

## Sobre `ApolloServer()`
El `ApolloServer()` puede recibir muchas opciones, uno es el objeto CORS pero este no funciona o en m√≠ caso no funcion√≥.

Un ejemplo:

```js
const { ApolloServer } = require('apollo-server-lambda');
const { typeDefs, resolvers } = require('./graphql/index');

const server = new ApolloServer({
  typeDefs,
  resolvers,
  // En teor√≠a esto deber√≠a funcionar.
  cors: {
    origin: '*',
    credentials: true
  }
});
```

## Soluci√≥n
Despu√©s de buscar en internet encontr√© una soluci√≥n en github. üòé

> Vuelvo a aclarar que est√° soluci√≥n es aplic√°ndola en **Apollo Server Lambda**, la verdad que no tengo idea si est√° soluci√≥n funciona tambi√©n en el resto de m√≥dulos de Apollo Server, creer√≠a que es lo mismo, pero la verdad que no lo s√©.

La soluci√≥n que encontr√© fue eliminar CORS de `ApolloServer()` y pasarlo al `server.createHandler()` que es lo que vamos a exportar.

Pasamos exactamente el mismo objeto CORS.

Ejemplo:

```js
exports.handler = server.createHandler({
  cors: {
    origin: '*',
    credentials: true
  }
});
```

Y ac√° el c√≥digo completo para que se entienda mejor:

```js
const { ApolloServer } = require('apollo-server-lambda');
const { typeDefs, resolvers } = require('./graphql/index');

const server = new ApolloServer({
  typeDefs,
  resolvers
});

exports.handler = server.createHandler({
  cors: {
    origin: '*',
    credentials: true
  }
});
```

## Conclusi√≥n
Eso fue todo lo que tuve que hacer, solamente cambiar de lugar el objeto CORS.

¬°¬°Saludos!! ü§ôüèª
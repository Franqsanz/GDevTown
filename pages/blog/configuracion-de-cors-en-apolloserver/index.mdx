import BlogPost from '../../../components/BlogPost';

export const meta = {
  id: 6,
  img: '/static/cors-error.png',
  alt: 'CORS Error',
  width: 700,
  height: 294,
  title: 'ConfiguraciÃ³n de CORS en ApolloServer',
  description: 'TenÃ­a un error con CORS en mÃ­ API GraphQL que estÃ¡ construida con Apollo Server Lambda, cuando hacÃ­a una solicitud desde el frontend me daba el tÃ­pico error en la consola....',
  date: 'Feb. 27, 2021',
  readTime: 2
}

export default ({ children }) => <BlogPost meta={meta}>{children}</BlogPost>;

TenÃ­a un error con CORS en mÃ­ API GraphQL que estÃ¡ construida con Apollo Server Lambda, cuando hacÃ­a una solicitud desde el frontend me daba el tÃ­pico error en la consola, que mÃ¡s de uno/a debe haber visto alguna vez.
Pero yo me preguntÃ©, en mÃ­ API, sÃ­ agreguÃ© la opciÃ³n de CORS, entonces Â¿DÃ³nde estÃ¡ el problema?

## Sobre `ApolloServer()`
El `ApolloServer()` puede recibir muchas opciones, uno es el objeto CORS pero este no funciona o en mÃ­ caso no funcionÃ³.

Un ejemplo:

```js
const { ApolloServer } = require('apollo-server-lambda');
const { typeDefs, resolvers } = require('./graphql/index');

const server = new ApolloServer({
  typeDefs,
  resolvers,
  // En teorÃ­a esto deberÃ­a funcionar.
  cors: {
    origin: '*',
    credentials: true
  }
});
```

## SoluciÃ³n
DespuÃ©s de buscar en internet encontrÃ© una soluciÃ³n en github. ğŸ˜

> Vuelvo a aclarar que estÃ¡ soluciÃ³n es aplicÃ¡ndola en **Apollo Server Lambda**, la verdad que no tengo idea si estÃ¡ soluciÃ³n funciona tambiÃ©n en el resto de mÃ³dulos de Apollo Server, creerÃ­a que es lo mismo, pero la verdad que no lo sÃ©.

La soluciÃ³n que encontrÃ© fue eliminar CORS de `ApolloServer()` y pasarlo al `server.createHandler()` que es lo que vamos a exportar.

Pasamos exactamente el mismo objeto CORS.

Ejemplo:

```js
exports.handler = server.createHandler({
  cors: {
    origin: '*',
    credentials: true
  }
});
```

Y acÃ¡ el cÃ³digo completo para que se entienda mejor:

```js
const { ApolloServer } = require('apollo-server-lambda');
const { typeDefs, resolvers } = require('./graphql/index');

const server = new ApolloServer({
  typeDefs,
  resolvers
});

exports.handler = server.createHandler({
  cors: {
    origin: '*',
    credentials: true
  }
});
```

## ConclusiÃ³n
Eso fue todo lo que tuve que hacer, solamente cambiar de lugar el objeto CORS.

Â¡Â¡Saludos!! ğŸ¤™ğŸ»

ğŸ“ [Editar en GitHub](https://github.com/Franqsanz/GDevTown/blob/main/pages/blog/configuracion-de-cors-en-apolloserver/index.mdx)